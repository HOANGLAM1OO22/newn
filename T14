R·∫•t t·ªët üëç
B√¢y gi·ªù ch√∫ng ta ƒë·∫øn **Commit 3** ‚Äî ƒë√¢y l√† commit quan tr·ªçng nh·∫•t trong to√†n b·ªô qu√° tr√¨nh refactor VideoRental.
M·ª•c ti√™u l√† **lo·∫°i b·ªè switch-case** trong `Customer` v√† **thay b·∫±ng ƒëa h√¨nh (Polymorphism)** th√¥ng qua l·ªõp tr·ª´u t∆∞·ª£ng `Price`.

---

## üéØ M·ª•c ti√™u Commit 3

* Thay th·∫ø `switch (priceCode)` b·∫±ng c√°c l·ªõp con k·∫ø th·ª´a t·ª´ `Price`.
* Di chuy·ªÉn logic t√≠nh ph√≠ v√† ƒëi·ªÉm th∆∞·ªüng t·ª´ `Customer` sang `Movie` ‚Üí `Price`.
* Code ph·∫£i **ƒë·∫°t c√πng k·∫øt qu·∫£ v·ªõi commit 2** (to√†n b·ªô test v·∫´n **PASS**).

---

## üîß Thi·∫øt k·∫ø l·ªõp m·ªõi

### üß© C·∫•u tr√∫c m·ªõi

```
src/main/java/
 ‚îú‚îÄ‚îÄ Customer.java
 ‚îú‚îÄ‚îÄ Movie.java
 ‚îú‚îÄ‚îÄ Price.java ‚Üê NEW (abstract base)
 ‚îú‚îÄ‚îÄ RegularPrice.java ‚Üê NEW
 ‚îú‚îÄ‚îÄ NewReleasePrice.java ‚Üê NEW
 ‚îú‚îÄ‚îÄ ChildrenPrice.java ‚Üê NEW
 ‚îú‚îÄ‚îÄ Rental.java
 ‚îî‚îÄ‚îÄ RentalManager.java
```

---

## üß± Full Code (Commit 3)

### ‚úÖ Price.java (new)

```java
public abstract class Price {
    abstract int getPriceCode();
    abstract double getCharge(int daysRented);

    int getFrequentRenterPoints(int daysRented) {
        return 1;
    }
}
```

---

### ‚úÖ RegularPrice.java

```java
public class RegularPrice extends Price {
    @Override
    int getPriceCode() {
        return Movie.REGULAR;
    }

    @Override
    double getCharge(int daysRented) {
        double result = 2;
        if (daysRented > 2)
            result += (daysRented - 2) * 1.5;
        return result;
    }
}
```

---

### ‚úÖ NewReleasePrice.java

```java
public class NewReleasePrice extends Price {
    @Override
    int getPriceCode() {
        return Movie.NEW_RELEASE;
    }

    @Override
    double getCharge(int daysRented) {
        return daysRented * 3;
    }

    @Override
    int getFrequentRenterPoints(int daysRented) {
        return (daysRented > 1) ? 2 : 1;
    }
}
```

---

### ‚úÖ ChildrenPrice.java

```java
public class ChildrenPrice extends Price {
    @Override
    int getPriceCode() {
        return Movie.CHILDREN;
    }

    @Override
    double getCharge(int daysRented) {
        double result = 1.5;
        if (daysRented > 3)
            result += (daysRented - 3) * 1.5;
        return result;
    }
}
```

---

### ‚úÖ Movie.java (refactored)

```java
public class Movie {
    public static final int REGULAR = 0;
    public static final int NEW_RELEASE = 1;
    public static final int CHILDREN = 2;
    public static final int BEST_SELLER = 3; // placeholder cho commit 4

    private String title;
    private Price price;

    public Movie(String title, int priceCode) {
        this.title = title;
        setPriceCode(priceCode);
    }

    public int getPriceCode() {
        return price.getPriceCode();
    }

    public void setPriceCode(int priceCode) {
        switch (priceCode) {
            case REGULAR:
                price = new RegularPrice();
                break;
            case NEW_RELEASE:
                price = new NewReleasePrice();
                break;
            case CHILDREN:
                price = new ChildrenPrice();
                break;
            default:
                throw new IllegalArgumentException("Invalid price code");
        }
    }

    public String getTitle() {
        return title;
    }

    public double getCharge(int daysRented) {
        return price.getCharge(daysRented);
    }

    public int getFrequentRenterPoints(int daysRented) {
        return price.getFrequentRenterPoints(daysRented);
    }
}
```

---

### ‚úÖ Customer.java (refactored ‚Äî clean)

```java
import java.util.Enumeration;
import java.util.Vector;

public class Customer {
    private String name;
    private Vector<Rental> rentals = new Vector<>();

    public Customer(String name) {
        this.name = name;
    }

    public void addRental(Rental rental) {
        rentals.add(rental);
    }

    public String getName() {
        return name;
    }

    public String statement() {
        double totalAmount = 0;
        int frequentRenterPoints = 0;
        Enumeration<Rental> enumRentals = rentals.elements();
        StringBuilder result = new StringBuilder("Rental Record for " + getName() + "\n");

        while (enumRentals.hasMoreElements()) {
            Rental each = enumRentals.nextElement();

            double thisAmount = each.getMovie().getCharge(each.getDaysRented());
            frequentRenterPoints += each.getMovie().getFrequentRenterPoints(each.getDaysRented());

            result.append("\t")
                    .append(each.getMovie().getTitle())
                    .append("\t")
                    .append(thisAmount)
                    .append("\n");

            totalAmount += thisAmount;
        }

        result.append("Amount owed is ").append(totalAmount).append("\n");
        result.append("You earned ").append(frequentRenterPoints).append(" frequent renter points");

        return result.toString();
    }
}
```

---

### ‚úÖ Rental.java (unchanged)

```java
public class Rental {
    private Movie movie;
    private int daysRented;

    public Rental(Movie movie, int daysRented) {
        this.movie = movie;
        this.daysRented = daysRented;
    }

    public int getDaysRented() {
        return daysRented;
    }

    public Movie getMovie() {
        return movie;
    }
}
```

---

### ‚úÖ RentalManager.java (optional demo)

```java
public class RentalManager {
    public static void main(String[] args) {
        Customer customer = new Customer("Hong");
        customer.addRental(new Rental(new Movie("Inception", Movie.REGULAR), 3));
        customer.addRental(new Rental(new Movie("Frozen", Movie.CHILDREN), 4));
        customer.addRental(new Rental(new Movie("Oppenheimer", Movie.NEW_RELEASE), 2));

        System.out.println(customer.statement());
    }
}
```

---

## üß™ Test verification

T·∫•t c·∫£ test t·ª´ **Commit 1** ph·∫£i ch·∫°y PASS ‚Äî ch·ª©ng t·ªè vi·ªác refactor ƒë√£ **b·∫£o to√†n h√†nh vi g·ªëc**.
N·∫øu b·∫°n d√πng JUnit 5, ch·ªâ c·∫ßn ch·∫°y:

```bash
mvn test
# ho·∫∑c
gradle test
```

---

## üßæ Commit message g·ª£i √Ω

```
refactor: replace conditional with Price polymorphism in Movie and Customer
```

---

## ‚úÖ K·∫øt qu·∫£ sau Commit 3

| Tr∆∞·ªõc                      | Sau                                    |
| -------------------------- | -------------------------------------- |
| Switch-case trong Customer | ‚úÖ Lo·∫°i b·ªè ho√†n to√†n                    |
| T√≠nh ph√≠ & ƒëi·ªÉm th∆∞·ªüng     | ‚úÖ Di chuy·ªÉn sang Price subclasses      |
| Code d·ªÖ m·ªü r·ªông            | ‚úÖ Chu·∫©n b·ªã cho ‚ÄúBestseller‚Äù ·ªü commit 4 |
| Logic g·ªëc                  | ‚úÖ Gi·ªØ nguy√™n, test pass to√†n b·ªô        |

---

B·∫°n c√≥ mu·ªën m√¨nh ti·∫øp t·ª•c t·∫°o **Commit 4 (Add Bestseller type + test)** ngay sau ƒë√¢y kh√¥ng?
ƒê√¢y l√† ph·∫ßn b·∫°n s·∫Ω th√™m feature m·ªõi th·∫≠t s·ª± (ph√≠ $5/day v√† $7.5/day, 5 points/day).
