T·ªët l·∫Øm üëç
B·∫°n ƒë√£ xong **Commit 1** (ƒë·∫ßy ƒë·ªß test bao ph·ªß to√†n b·ªô h√†nh vi legacy).
Gi·ªù sang **Commit 2**, ch√∫ng ta **b·∫Øt ƒë·∫ßu refactor** ƒë·ªÉ hi·ªÉu r√µ h∆°n code c≈© ‚Äî *ch∆∞a ƒë·ªïi logic, ch·ªâ c·∫£i thi·ªán c·∫•u tr√∫c*.

---

## üéØ M·ª•c ti√™u Commit 2

> Refactor code t√≠nh ph√≠ v√† ƒëi·ªÉm th∆∞·ªüng trong `Customer.statement()` ƒë·ªÉ d·ªÖ ƒë·ªçc, d·ªÖ b·∫£o tr√¨, v√† chu·∫©n b·ªã cho polymorphism ·ªü commit sau.

---

## üß© C√°c b∆∞·ªõc refactor Commit 2

1. **T√°ch logic t√≠nh ti·ªÅn ra kh·ªèi v√≤ng l·∫∑p** ‚Äî ƒë∆∞a v√†o h√†m ri√™ng (`amountFor(Rental rental)`).
2. **T√°ch logic t√≠nh ƒëi·ªÉm th∆∞·ªüng** ‚Äî ƒë∆∞a v√†o h√†m ri√™ng (`getFrequentRenterPoints(Rental rental)`).
3. **Gi·ªØ nguy√™n switch-case** (ch∆∞a thay b·∫±ng polymorphism).
4. **Code test hi·ªán t·∫°i ph·∫£i PASS** (ƒë·∫£m b·∫£o refactor an to√†n).

---

## üì¶ K·∫øt qu·∫£ sau Commit 2

### ‚úÖ Customer.java (refactored)

```java
import java.util.Enumeration;
import java.util.Vector;

public class Customer {
    private String name;
    private Vector<Rental> rentals = new Vector<>();

    public Customer(String name) {
        this.name = name;
    }

    public void addRental(Rental rental) {
        rentals.add(rental);
    }

    public String getName() {
        return name;
    }

    public String statement() {
        double totalAmount = 0;
        int frequentRenterPoints = 0;
        Enumeration<Rental> enumRentals = rentals.elements();
        StringBuilder result = new StringBuilder("Rental Record for " + getName() + "\n");

        while (enumRentals.hasMoreElements()) {
            Rental each = enumRentals.nextElement();

            double thisAmount = amountFor(each);
            int points = getFrequentRenterPoints(each);

            frequentRenterPoints += points;
            result.append("\t")
                    .append(each.getMovie().getTitle())
                    .append("\t")
                    .append(thisAmount)
                    .append("\n");

            totalAmount += thisAmount;
        }

        result.append("Amount owed is ").append(totalAmount).append("\n");
        result.append("You earned ").append(frequentRenterPoints).append(" frequent renter points");

        return result.toString();
    }

    private double amountFor(Rental rental) {
        double result = 0;
        switch (rental.getMovie().getPriceCode()) {
            case Movie.REGULAR:
                result += 2;
                if (rental.getDaysRented() > 2)
                    result += (rental.getDaysRented() - 2) * 1.5;
                break;
            case Movie.NEW_RELEASE:
                result += rental.getDaysRented() * 3;
                break;
            case Movie.CHILDREN:
                result += 1.5;
                if (rental.getDaysRented() > 3)
                    result += (rental.getDaysRented() - 3) * 1.5;
                break;
        }
        return result;
    }

    private int getFrequentRenterPoints(Rental rental) {
        int points = 1;
        // bonus for two-day new release rental
        if ((rental.getMovie().getPriceCode() == Movie.NEW_RELEASE) &&
                rental.getDaysRented() > 1) {
            points++;
        }
        return points;
    }
}
```

---

### ‚úÖ Movie.java (unchanged)

```java
public class Movie {
    public static final int REGULAR = 0;
    public static final int NEW_RELEASE = 1;
    public static final int CHILDREN = 2;

    private String title;
    private int priceCode;

    public Movie(String title, int priceCode) {
        this.title = title;
        this.priceCode = priceCode;
    }

    public int getPriceCode() {
        return priceCode;
    }

    public void setPriceCode(int priceCode) {
        this.priceCode = priceCode;
    }

    public String getTitle() {
        return title;
    }
}
```

---

### ‚úÖ Rental.java (unchanged)

```java
public class Rental {
    private Movie movie;
    private int daysRented;

    public Rental(Movie movie, int daysRented) {
        this.movie = movie;
        this.daysRented = daysRented;
    }

    public int getDaysRented() {
        return daysRented;
    }

    public Movie getMovie() {
        return movie;
    }
}
```

---

### ‚úÖ RentalManager.java (demo, optional)

```java
public class RentalManager {
    public static void main(String[] args) {
        Customer customer = new Customer("Hong");
        Movie regular = new Movie("Inception", Movie.REGULAR);
        Movie newRelease = new Movie("Oppenheimer", Movie.NEW_RELEASE);
        Movie children = new Movie("Frozen", Movie.CHILDREN);

        customer.addRental(new Rental(regular, 3));
        customer.addRental(new Rental(newRelease, 2));
        customer.addRental(new Rental(children, 4));

        System.out.println(customer.statement());
    }
}
```

---

## ‚úÖ K·∫øt qu·∫£ mong ƒë·ª£i

* **Kh√¥ng thay ƒë·ªïi output** so v·ªõi commit 1.
* Code r√µ r√†ng h∆°n, chia nh·ªè h√†m h·ª£p l√Ω.
* ƒê√£ chu·∫©n b·ªã cho commit 3: **‚ÄúReplace Conditional with Polymorphism‚Äù**.

---

## üßæ Commit message g·ª£i √Ω:

```
refactor: extract amountFor() and getFrequentRenterPoints() from Customer.statement()
```

---

B·∫°n c√≥ mu·ªën m√¨nh ti·∫øp t·ª•c **Commit 3 (Introduce Price hierarchy ‚Äî Replace Conditional with Polymorphism)** li·ªÅn b√¢y gi·ªù kh√¥ng?
Commit n√†y l√† b∆∞·ªõc quan tr·ªçng nh·∫•t trong qu√° tr√¨nh refactor.
