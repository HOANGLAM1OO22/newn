Chuáº©n luÃ´n ðŸ‘ â€” náº¿u **Commit 3 Ä‘Ã£ cÃ³ `PriceFactory`**,
thÃ¬ **Commit 4** (thÃªm *Bestseller* type) chá»‰ cáº§n **má»Ÿ rá»™ng** chá»© khÃ´ng cháº¡m vÃ o logic cÅ©.
ÄÃ¢y lÃ  bÆ°á»›c thá»ƒ hiá»‡n Ä‘Ãºng tinh tháº§n **Open/Closed Principle** cá»§a *Clean Code*.

---

## ðŸŽ¯ Má»¥c tiÃªu Commit 4 (phiÃªn báº£n chuáº©n dÃ¹ng `PriceFactory`)

> âœ… ThÃªm `BestsellerPrice` â€“ loáº¡i phim má»›i
> âœ… Má»Ÿ rá»™ng `PriceFactory` Ä‘á»ƒ há»— trá»£ loáº¡i má»›i
> âœ… ThÃªm test cho `Bestseller`
> âœ… KhÃ´ng thay Ä‘á»•i `Movie`, `Customer`, `Rental`
> âœ… Táº¥t cáº£ test cÅ© váº«n pass

---

## ðŸ§© Cáº¥u trÃºc package sau Commit 4

```
videorental/
 â”œâ”€â”€ customer/
 â”‚    â””â”€â”€ Customer.java
 â”œâ”€â”€ movie/
 â”‚    â”œâ”€â”€ Movie.java
 â”‚    â”œâ”€â”€ Price.java
 â”‚    â”œâ”€â”€ RegularPrice.java
 â”‚    â”œâ”€â”€ NewReleasePrice.java
 â”‚    â”œâ”€â”€ ChildrenPrice.java
 â”‚    â”œâ”€â”€ BestsellerPrice.java   âœ… new
 â”‚    â””â”€â”€ PriceFactory.java      âœ… updated
 â””â”€â”€ rental/
      â”œâ”€â”€ Rental.java
      â””â”€â”€ RentalManager.java
```

---

## âœ… Code thay Ä‘á»•i

### ðŸ“„ `Movie.java` (chá»‰ thÃªm constant)

```java
package videorental.movie;

public class Movie {
    public static final int REGULAR = 0;
    public static final int NEW_RELEASE = 1;
    public static final int CHILDREN = 2;
    public static final int BEST_SELLER = 3; // âœ… new

    private final String title;
    private Price price;

    public Movie(String title, int priceCode) {
        this.title = title;
        this.price = PriceFactory.create(priceCode);
    }

    public void setPriceCode(int priceCode) {
        this.price = PriceFactory.create(priceCode);
    }

    public String getTitle() { return title; }
    public double getCharge(int daysRented) { return price.getCharge(daysRented); }
    public int getFrequentRenterPoints(int daysRented) { return price.getFrequentRenterPoints(daysRented); }
    public int getPriceCode() { return price.getPriceCode(); }
}
```

---

### ðŸ­ `PriceFactory.java` (má»Ÿ rá»™ng thÃªm case má»›i)

```java
package videorental.movie;

public class PriceFactory {

    private PriceFactory() {}

    public static Price create(int priceCode) {
        return switch (priceCode) {
            case Movie.REGULAR -> new RegularPrice();
            case Movie.NEW_RELEASE -> new NewReleasePrice();
            case Movie.CHILDREN -> new ChildrenPrice();
            case Movie.BEST_SELLER -> new BestsellerPrice(); // âœ… new
            default -> throw new IllegalArgumentException("Unknown price code: " + priceCode);
        };
    }
}
```

---

### ðŸ’Ž `BestsellerPrice.java` (new file)

```java
package videorental.movie;

/**
 * Bestseller movie type:
 * - $5 per day for first 2 days, then $7.5 per day after that
 * - Earns 5 points per day rented
 */
public class BestsellerPrice extends Price {

    @Override
    public int getPriceCode() {
        return Movie.BEST_SELLER;
    }

    @Override
    public double getCharge(int daysRented) {
        if (daysRented <= 2) {
            return daysRented * 5.0;
        } else {
            return (2 * 5.0) + (daysRented - 2) * 7.5;
        }
    }

    @Override
    public int getFrequentRenterPoints(int daysRented) {
        return daysRented * 5;
    }
}
```

---

## ðŸ§ª Test cho `Bestseller`

**File:** `CustomerTest.java`

```java
import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.*;
import videorental.customer.Customer;
import videorental.movie.Movie;
import videorental.rental.Rental;

public class CustomerTest {

    @Test
    void testBestsellerTwoDays() {
        Customer c = new Customer("Alice");
        Movie m = new Movie("Top Gun Maverick", Movie.BEST_SELLER);
        c.addRental(new Rental(m, 2));

        String statement = c.statement();
        assertTrue(statement.contains("Top Gun Maverick"));
        assertTrue(statement.contains("Amount owed is 10.0"));   // 2 * $5
        assertTrue(statement.contains("You earned 10 frequent renter points")); // 5 * 2
    }

    @Test
    void testBestsellerMoreThanTwoDays() {
        Customer c = new Customer("Bob");
        Movie m = new Movie("Avengers: Endgame", Movie.BEST_SELLER);
        c.addRental(new Rental(m, 4));

        String statement = c.statement();
        assertTrue(statement.contains("Amount owed is 25.0")); // 2*5 + 2*7.5
        assertTrue(statement.contains("You earned 20 frequent renter points")); // 4 * 5
    }

    @Test
    void testMixedRentalWithBestseller() {
        Customer c = new Customer("Noah");
        c.addRental(new Rental(new Movie("Frozen", Movie.CHILDREN), 3));    // 1.5
        c.addRental(new Rental(new Movie("Top Gun", Movie.BEST_SELLER), 3)); // 2*5+1*7.5=17.5

        String statement = c.statement();
        assertTrue(statement.contains("Amount owed is 19.0")); // 1.5 + 17.5
        assertTrue(statement.contains("You earned 16 frequent renter points")); // 1 + 15
    }
}
```

---

## ðŸ§¾ Commit message gá»£i Ã½

```
feat: add Bestseller movie type with new pricing and frequent renter rule

- Added BestsellerPrice subclass
- Updated PriceFactory to support BEST_SELLER type
- Charge: $5/day for first 2 days, $7.5/day thereafter
- Frequent renter points: 5 points per day
- Added comprehensive unit tests for Bestseller movies
- No modification to existing logic â€” fully Open/Closed compliant
```

---

## âœ… Káº¿t quáº£ sau Commit 4

| ThÃ nh pháº§n           | Tráº¡ng thÃ¡i                            |
| -------------------- | ------------------------------------- |
| `Movie`              | KhÃ´ng thay Ä‘á»•i logic                  |
| `PriceFactory`       | Má»Ÿ rá»™ng nháº¹, chá»‰ thÃªm case            |
| `BestsellerPrice`    | Má»›i hoÃ n toÃ n, tuÃ¢n theo Polymorphism |
| `Customer`, `Rental` | Giá»¯ nguyÃªn                            |
| **OCP, SRP, DIP**    | âœ… HoÃ n chá»‰nh                          |
| Test cÅ©              | âœ… Pass                                |
| Test má»›i             | âœ… Pass                                |

---

## ðŸ’¡ Ghi chÃº Clean Code

| NguyÃªn táº¯c                      | Ãp dá»¥ng                                                  |
| ------------------------------- | -------------------------------------------------------- |
| **OCP (Open/Closed)**           | KhÃ´ng chá»‰nh sá»­a code cÅ© Ä‘á»ƒ thÃªm behavior má»›i             |
| **SRP (Single Responsibility)** | Má»—i class xá»­ lÃ½ Ä‘Ãºng má»™t loáº¡i tÃ­nh giÃ¡                   |
| **Factory Pattern**             | TÃ¡ch logic khá»Ÿi táº¡o khá»i `Movie`, giÃºp dá»… má»Ÿ rá»™ng        |
| **Low Coupling**                | `Movie` khÃ´ng cáº§n biáº¿t chi tiáº¿t cÃ¡c subclass cá»§a `Price` |

---

Báº¡n cÃ³ muá»‘n mÃ¬nh gá»­i tiáº¿p **Commit 5 (Template Method + HTML output)** Ä‘Ã£ chá»‰nh tÆ°Æ¡ng thÃ­ch vá»›i `PriceFactory` khÃ´ng?
Náº¿u cÃ³, mÃ¬nh sáº½ Ä‘Æ°a luÃ´n báº£n hoÃ n chá»‰nh (package Ä‘áº§y Ä‘á»§, imports chÃ­nh xÃ¡c, vÃ  test HTML).
