R·∫•t chu·∫©n üí™ ‚Äî n·∫øu m·ª•c ti√™u c·ªßa b·∫°n l√† **code th·∫≠t s·∫°ch, m·ªü r·ªông d·ªÖ**, th√¨ ƒë√∫ng r·ªìi:
‚Üí **n√™n ƒë∆∞a `PriceFactory`** (v√† t√πy ch·ªçn `StatementFactory`) **ngay t·ª´ Commit 3**, khi b·∫°n ƒë√£ refactor `switch` ‚Üí polymorphism.

C√°ch n√†y gi√∫p b·∫°n **x√≥a lu√¥n switch-case trong `Movie`** c√πng l√∫c v·ªõi vi·ªác t√°ch `Price` hierarchy, ƒë·ªÉ `Movie` ch·ªâ c·∫ßn *‚Äúg·ªçi factory‚Äù* ch·ª© kh√¥ng bi·∫øt chi ti·∫øt subclass n√†o ƒë∆∞·ª£c t·∫°o.

---

## üß≠ M·ª•c ti√™u Commit 3 (phi√™n b·∫£n n√¢ng cao v·ªõi Factory)

> * Thay th·∫ø switch-case trong `Movie.setPriceCode()` b·∫±ng **PriceFactory**
> * Gi·ªØ tinh th·∫ßn **Replace Conditional with Polymorphism**
> * ƒê·∫°t **Open/Closed Principle (OCP)** ngay t·ª´ b∆∞·ªõc refactor ƒë·∫ßu ti√™n

---

## ‚úÖ Full Code Commit 3 (Refactor + Factory)

### üì¶ Package layout

```
videorental/
 ‚îú‚îÄ‚îÄ customer/
 ‚îÇ    ‚îî‚îÄ‚îÄ Customer.java
 ‚îú‚îÄ‚îÄ movie/
 ‚îÇ    ‚îú‚îÄ‚îÄ Movie.java
 ‚îÇ    ‚îú‚îÄ‚îÄ Price.java
 ‚îÇ    ‚îú‚îÄ‚îÄ RegularPrice.java
 ‚îÇ    ‚îú‚îÄ‚îÄ NewReleasePrice.java
 ‚îÇ    ‚îú‚îÄ‚îÄ ChildrenPrice.java
 ‚îÇ    ‚îî‚îÄ‚îÄ PriceFactory.java   ‚úÖ new
 ‚îú‚îÄ‚îÄ rental/
 ‚îÇ    ‚îú‚îÄ‚îÄ Rental.java
 ‚îÇ    ‚îî‚îÄ‚îÄ RentalManager.java
```

---

### üé¨ `Movie.java`

```java
package videorental.movie;

/**
 * Movie class represents a film with a specific pricing strategy.
 * It delegates charge and frequent renter points calculation
 * to a Price object, created via PriceFactory.
 */
public class Movie {
    public static final int REGULAR = 0;
    public static final int NEW_RELEASE = 1;
    public static final int CHILDREN = 2;

    private final String title;
    private Price price;

    public Movie(String title, int priceCode) {
        this.title = title;
        this.price = PriceFactory.create(priceCode);
    }

    public String getTitle() {
        return title;
    }

    public double getCharge(int daysRented) {
        return price.getCharge(daysRented);
    }

    public int getFrequentRenterPoints(int daysRented) {
        return price.getFrequentRenterPoints(daysRented);
    }

    public void setPriceCode(int priceCode) {
        this.price = PriceFactory.create(priceCode);
    }

    public int getPriceCode() {
        return price.getPriceCode();
    }
}
```

---

### üè≠ `PriceFactory.java`

```java
package videorental.movie;

/**
 * Factory pattern for creating Price instances.
 * Keeps Movie class free of switch statements.
 */
public class PriceFactory {

    private PriceFactory() {} // Prevent instantiation

    public static Price create(int priceCode) {
        return switch (priceCode) {
            case Movie.REGULAR -> new RegularPrice();
            case Movie.NEW_RELEASE -> new NewReleasePrice();
            case Movie.CHILDREN -> new ChildrenPrice();
            default -> throw new IllegalArgumentException("Unknown price code: " + priceCode);
        };
    }
}
```

---

### üí∞ `Price.java`

```java
package videorental.movie;

/**
 * Abstract Price class ‚Äî defines the interface for pricing strategies.
 */
public abstract class Price {
    public abstract int getPriceCode();
    public abstract double getCharge(int daysRented);

    public int getFrequentRenterPoints(int daysRented) {
        return 1;
    }
}
```

---

### üß© `RegularPrice.java`

```java
package videorental.movie;

public class RegularPrice extends Price {

    @Override
    public int getPriceCode() {
        return Movie.REGULAR;
    }

    @Override
    public double getCharge(int daysRented) {
        double result = 2.0;
        if (daysRented > 2) {
            result += (daysRented - 2) * 1.5;
        }
        return result;
    }
}
```

---

### üÜï `NewReleasePrice.java`

```java
package videorental.movie;

public class NewReleasePrice extends Price {

    @Override
    public int getPriceCode() {
        return Movie.NEW_RELEASE;
    }

    @Override
    public double getCharge(int daysRented) {
        return daysRented * 3.0;
    }

    @Override
    public int getFrequentRenterPoints(int daysRented) {
        return (daysRented > 1) ? 2 : 1;
    }
}
```

---

### üßí `ChildrenPrice.java`

```java
package videorental.movie;

public class ChildrenPrice extends Price {

    @Override
    public int getPriceCode() {
        return Movie.CHILDREN;
    }

    @Override
    public double getCharge(int daysRented) {
        double result = 1.5;
        if (daysRented > 3) {
            result += (daysRented - 3) * 1.5;
        }
        return result;
    }
}
```

---

### üéü `Rental.java`

```java
package videorental.rental;

import videorental.movie.Movie;

/**
 * Rental represents a customer's rental of a specific movie.
 * It delegates pricing to the Movie object.
 */
public class Rental {
    private final Movie movie;
    private final int daysRented;

    public Rental(Movie movie, int daysRented) {
        this.movie = movie;
        this.daysRented = daysRented;
    }

    public int getDaysRented() {
        return daysRented;
    }

    public Movie getMovie() {
        return movie;
    }

    public double getCharge() {
        return movie.getCharge(daysRented);
    }

    public int getFrequentRenterPoints() {
        return movie.getFrequentRenterPoints(daysRented);
    }
}
```

---

### üë§ `Customer.java`

```java
package videorental.customer;

import videorental.rental.Rental;
import java.util.Enumeration;
import java.util.Vector;

/**
 * Customer holds a collection of rentals and can produce billing statements.
 */
public class Customer {
    private final String name;
    private final Vector<Rental> rentals = new Vector<>();

    public Customer(String name) {
        this.name = name;
    }

    public void addRental(Rental rental) {
        rentals.add(rental);
    }

    public String getName() {
        return name;
    }

    public String statement() {
        double totalAmount = 0;
        int frequentRenterPoints = 0;
        StringBuilder result = new StringBuilder("Rental Record for " + getName() + "\n");

        Enumeration<Rental> elements = rentals.elements();
        while (elements.hasMoreElements()) {
            Rental rental = elements.nextElement();

            double thisAmount = rental.getCharge();
            frequentRenterPoints += rental.getFrequentRenterPoints();

            result.append("\t")
                  .append(rental.getMovie().getTitle())
                  .append("\t")
                  .append(thisAmount)
                  .append("\n");

            totalAmount += thisAmount;
        }

        result.append("Amount owed is ").append(totalAmount).append("\n");
        result.append("You earned ").append(frequentRenterPoints).append(" frequent renter points");
        return result.toString();
    }
}
```

---

### ‚ñ∂Ô∏è `RentalManager.java` (demo run)

```java
package videorental.rental;

import videorental.customer.Customer;
import videorental.movie.Movie;

public class RentalManager {
    public static void main(String[] args) {
        Customer customer = new Customer("Hong");

        customer.addRental(new Rental(new Movie("Inception", Movie.REGULAR), 3));
        customer.addRental(new Rental(new Movie("Oppenheimer", Movie.NEW_RELEASE), 2));
        customer.addRental(new Rental(new Movie("Frozen", Movie.CHILDREN), 4));

        System.out.println(customer.statement());
    }
}
```

---

## üßæ Commit message (chu·∫©n Clean Code style)

```
refactor: replace conditional with polymorphism and add PriceFactory

- Introduced PriceFactory to encapsulate Price creation logic
- Removed switch-case from Movie; Movie now delegates to PriceFactory
- Added abstract Price and subclasses (Regular, NewRelease, Children)
- Simplified Customer.statement() to use delegation through Rental
- Improved code extensibility and adherence to Open/Closed Principle
```

---

## ‚úÖ K·∫øt qu·∫£ sau Commit 3 (v·ªõi Factory)

| Tr∆∞·ªõc                                   | Sau                                                              |
| --------------------------------------- | ---------------------------------------------------------------- |
| `Movie` ch·ª©a `switch-case` ƒë·ªÉ t·∫°o Price | `Movie` d√πng `PriceFactory.create()`                             |
| Th√™m lo·∫°i phim ‚Üí s·ª≠a `Movie`            | Th√™m lo·∫°i phim ‚Üí ch·ªâ th√™m subclass + 1 d√≤ng trong `PriceFactory` |
| Coupling cao                            | Coupling th·∫•p, d·ªÖ test                                           |
| Vi ph·∫°m OCP                             | Tu√¢n th·ªß OCP, SRP, DIP                                           |

---

üëâ **K·∫øt lu·∫≠n:**

* Th√™m **Factory trong Commit 3** l√† l·ª±a ch·ªçn ƒë√∫ng v√† chuy√™n nghi·ªáp nh·∫•t.
* N√≥ gi√∫p b·∫°n refactor tri·ªát ƒë·ªÉ, ƒë·∫°t **Clean Architecture** s·ªõm, v√† chu·∫©n b·ªã s·∫µn n·ªÅn t·∫£ng cho commit 4 (th√™m Bestseller) c·ª±c d·ªÖ.

---

B·∫°n c√≥ mu·ªën m√¨nh g·ª≠i **Commit 4 + 5 version sau n√†y (Bestseller + HTML Template)** ƒë√£ c·∫≠p nh·∫≠t ƒë·ªÉ t∆∞∆°ng th√≠ch v·ªõi Factory lu√¥n kh√¥ng (t·ª©c l√† d√πng `PriceFactory` v√† `StatementFactory`)?
N√≥ s·∫Ω th√†nh b·∫£n ho√†n ch·ªânh nh·∫•t ‚Äî b·∫°n c√≥ th·ªÉ push GitHub tr·ª±c ti·∫øp.
